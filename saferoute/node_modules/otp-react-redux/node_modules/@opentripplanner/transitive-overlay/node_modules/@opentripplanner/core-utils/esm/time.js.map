{"version":3,"sources":["../src/time.ts"],"names":["startOfDay","add","format","formatDuration","dateFnsFormatDuration","utcToZonedTime","formatTime","formatDurationWithSeconds","OTP_API_DATE_FORMAT","OTP_API_DATE_FORMAT_DATE_FNS","OTP_API_TIME_FORMAT","formatDurationLikeMoment","seconds","showSeconds","localize","enabled","code","hours","Math","floor","minutes","secondsLeftOver","specLookup","xHours","xMinutes","xSeconds","locale","formatDistance","spec","val","undefined","toHoursMinutesSeconds","getTimeFormat","config","dateTime","timeFormat","getDateFormat","dateFormat","getLongDateFormat","longDateFormat","offsetTime","ms","options","offset","formatSecondsAfterMidnight","time","Date","getUserTimezone","fallbackTimezone","process","env","NODE_ENV","TZ","Intl","DateTimeFormat","resolvedOptions","timeZone","getCurrentTime","timezone","now","getCurrentDate"],"mappings":"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","sourcesContent":["import { Config } from \"@opentripplanner/types\";\nimport {\n  startOfDay,\n  add,\n  format,\n  formatDuration as dateFnsFormatDuration\n} from \"date-fns\";\nimport { utcToZonedTime } from \"date-fns-tz\";\n\n/* eslint-disable import/no-cycle */\nimport {\n  formatTime,\n  formatDurationWithSeconds,\n  formatDuration\n} from \"./deprecated-with-types\";\n\nexport { formatTime, formatDuration, formatDurationWithSeconds };\n\n// special constants for making sure the following date format is always sent to\n// OTP regardless of whatever the user has configured as the display format\nexport const OTP_API_DATE_FORMAT = \"YYYY-MM-DD\";\n// Date-Fns uses a different string format than moment.js\n// see https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md\nexport const OTP_API_DATE_FORMAT_DATE_FNS = \"yyyy-MM-dd\";\nexport const OTP_API_TIME_FORMAT = \"HH:mm\";\n\n/**\n * To ease the transition away from moment.js, this method uses date-fns to format durations\n * the way moment.js did.\n * @param {number}  seconds     The number of seconds to format\n * @param {boolean} showSeconds Whether to render seconds or not\n * @param {boolean} localize    If true, will create output like moment.js using date-fns locale.\n * Otherwise, uses date-fns default\n * @returns                   Formatted duration\n */\nexport function formatDurationLikeMoment(\n  seconds: number,\n  showSeconds: boolean,\n  localize: { enabled: boolean; code: string } = {\n    enabled: true,\n    code: \"en-US\"\n  }\n): string {\n  // date-fns doesn't do this automatically\n  if ((!showSeconds && seconds < 60) || seconds === 0) {\n    return \"0 min\";\n  }\n\n  const hours = Math.floor(seconds / 3600);\n  const minutes = Math.floor((seconds - hours * 3600) / 60);\n  const secondsLeftOver = showSeconds\n    ? seconds - hours * 3600 - minutes * 60\n    : 0;\n  const specLookup = {\n    xHours: \"hr\",\n    xMinutes: \"min\",\n    xSeconds: \"sec\"\n  };\n  const locale = localize\n    ? {\n        // Maintain backwards compatibility when called with localize=true\n        code: localize?.code || \"en-US\",\n        formatDistance: (spec, val) => {\n          return `${val} ${specLookup[spec]}`;\n        }\n      }\n    : undefined;\n\n  return dateFnsFormatDuration(\n    {\n      hours,\n      minutes,\n      seconds: secondsLeftOver\n    },\n    {\n      format: [\"hours\", \"minutes\", \"seconds\"],\n      locale\n    }\n  );\n}\n\n/**\n * Breaks up a duration in seconds into hours, minutes, and seconds.\n * @param {number} seconds The number of seconds to break up\n * @returns an object with fields with the corresponding, hours, minutes, seconds.\n */\nexport function toHoursMinutesSeconds(seconds) {\n  const hours = Math.floor(seconds / 3600);\n  const minutes = Math.floor((seconds - hours * 3600) / 60);\n  return {\n    hours,\n    minutes,\n    seconds: seconds - hours * 3600 - minutes * 60\n  };\n}\n\n/**\n * @param  {[type]} config the OTP config object found in store\n * @return {string}        the config-defined time formatter or HH:mm (24-hr time)\n */\nexport function getTimeFormat(config: Config): string {\n  return config?.dateTime?.timeFormat || OTP_API_TIME_FORMAT;\n}\n\nexport function getDateFormat(config: Config): string {\n  return config?.dateTime?.dateFormat || OTP_API_DATE_FORMAT;\n}\n\nexport function getLongDateFormat(config: Config): string {\n  return config?.dateTime?.longDateFormat || \"D MMMM YYYY\";\n}\n/**\n * Offsets a time according to the provided time options\n * and returns the result.\n */\nexport function offsetTime(ms, options) {\n  return ms + (options?.offset || 0);\n}\n\n/**\n * Formats a seconds after midnight value for display in narrative\n * @param  {number} seconds  time since midnight in seconds\n * @param  {string} timeFormat  A valid date-fns time format\n * @return {string}                   formatted text representation\n */\nexport function formatSecondsAfterMidnight(\n  seconds: number,\n  timeFormat: string\n): string {\n  const time = add(startOfDay(new Date()), { seconds });\n  return format(time, timeFormat);\n}\n\n/**\n * Uses Intl.DateTimeFormat() api to get the user's time zone. In a test\n * environment, pulls timezone information from an env variable. Default to\n * GMT+0 if the Intl API is unavailable.\n */\nexport function getUserTimezone(fallbackTimezone = \"Etc/Greenwich\"): string {\n  if (process.env.NODE_ENV === \"test\") return process.env.TZ;\n  return Intl?.DateTimeFormat().resolvedOptions().timeZone || fallbackTimezone;\n}\n\n/**\n * Formats current time for use in OTP query\n * The conversion to the user's timezone is needed for testing purposes.\n */\nexport function getCurrentTime(timezone = getUserTimezone()): string {\n  return format(utcToZonedTime(Date.now(), timezone), OTP_API_TIME_FORMAT);\n}\n\n/**\n * Formats current date for use in OTP query\n * The conversion to the user's timezone is needed for testing purposes.\n */\nexport function getCurrentDate(timezone = getUserTimezone()): string {\n  return format(\n    utcToZonedTime(Date.now(), timezone),\n    OTP_API_DATE_FORMAT_DATE_FNS\n  );\n}\n"],"file":"time.js"}