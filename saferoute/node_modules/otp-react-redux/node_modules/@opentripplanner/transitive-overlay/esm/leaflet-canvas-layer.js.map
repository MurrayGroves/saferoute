{"version":3,"sources":["../src/leaflet-canvas-layer.js"],"names":["L","DomUtil","setTransform","el","offset","scale","pos","Point","style","TRANSFORM","Browser","ie3d","x","y","CanvasLayer","Layer","Class","extend","initialize","options","_map","_canvas","_frame","_delegate","setOptions","delegate","del","needRedraw","Util","requestAnimFrame","drawLayer","_onLayerDidResize","resizeEvent","width","newSize","height","_onLayerDidMove","topLeft","containerPointToLayerPoint","setPosition","getEvents","events","resize","moveend","zoom","zoomAnimation","any3d","zoomanim","_animateZoom","onAdd","map","create","tiles","size","getSize","animated","addClass","_panes","overlayPane","appendChild","on","onLayerDidMount","onRemove","onLayerWillUnmount","getPanes","removeChild","off","addTo","addLayer","LatLonToMercator","latlon","lng","Math","PI","log","tan","lat","bounds","getBounds","getZoom","center","getCenter","corner","containerPointToLatLng","onDrawLayer","layer","canvas","_setTransform","e","getZoomScale","_latLngBoundsToNewLayerBounds","min","_getCenterOffset","_multiplyBy","subtract","_getMapPanePos","canvasLayer"],"mappings":"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","sourcesContent":["/*\n  Generic  Canvas Layer for leaflet 0.7 and 1.0-rc,\n  copyright Stanislav Sumbera,  2016 , sumbera.com , license MIT\n  originally created and motivated by L.CanvasOverlay  available here: https://gist.github.com/Sumbera/11114288\n\n*/\n\n/* eslint-disable */\n\n// -- L.DomUtil.setTransform from leaflet 1.0.0 to work on 0.0.7\n//------------------------------------------------------------------------------\nL.DomUtil.setTransform = L.DomUtil.setTransform || function (el, offset, scale) {\n    var pos = offset || new L.Point(0, 0);\n\n    el.style[L.DomUtil.TRANSFORM] =\n        (L.Browser.ie3d ?\n            'translate(' + pos.x + 'px,' + pos.y + 'px)' :\n            'translate3d(' + pos.x + 'px,' + pos.y + 'px,0)') +\n        (scale ? ' scale(' + scale + ')' : '');\n};\n\n// -- support for both  0.0.7 and 1.0.0 rc2 leaflet\nL.CanvasLayer = (L.Layer ? L.Layer : L.Class).extend({\n    // -- initialized is called on prototype\n    initialize: function (options) {\n        this._map    = null;\n        this._canvas = null;\n        this._frame  = null;\n        this._delegate = null;\n        L.setOptions(this, options);\n    },\n\n    delegate :function(del){\n        this._delegate = del;\n        return this;\n    },\n\n    needRedraw: function () {\n        if (!this._frame) {\n            this._frame = L.Util.requestAnimFrame(this.drawLayer, this);\n        }\n        return this;\n    },\n\n    //-------------------------------------------------------------\n    _onLayerDidResize: function (resizeEvent) {\n        this._canvas.width = resizeEvent.newSize.x;\n        this._canvas.height = resizeEvent.newSize.y;\n    },\n    //-------------------------------------------------------------\n    _onLayerDidMove: function () {\n        var topLeft = this._map.containerPointToLayerPoint([0, 0]);\n        L.DomUtil.setPosition(this._canvas, topLeft);\n        this.drawLayer();\n    },\n    //-------------------------------------------------------------\n    getEvents: function () {\n        var events = {\n            resize: this._onLayerDidResize,\n            moveend: this._onLayerDidMove,\n            zoom: this._onLayerDidMove\n        };\n        if (this._map.options.zoomAnimation && L.Browser.any3d) {\n            events.zoomanim =  this._animateZoom;\n        }\n\n        return events;\n    },\n    //-------------------------------------------------------------\n    onAdd: function (map) {\n        this._map = map;\n        this._canvas = L.DomUtil.create('canvas', 'leaflet-layer');\n        this.tiles = {};\n\n        var size = this._map.getSize();\n        this._canvas.width = size.x;\n        this._canvas.height = size.y;\n\n        var animated = this._map.options.zoomAnimation && L.Browser.any3d;\n        L.DomUtil.addClass(this._canvas, 'leaflet-zoom-' + (animated ? 'animated' : 'hide'));\n\n\n        map._panes.overlayPane.appendChild(this._canvas);\n\n        map.on(this.getEvents(),this);\n\n        var del = this._delegate || this;\n        del.onLayerDidMount && del.onLayerDidMount(); // -- callback\n        this.needRedraw();\n    },\n\n    //-------------------------------------------------------------\n    onRemove: function (map) {\n        var del = this._delegate || this;\n        del.onLayerWillUnmount && del.onLayerWillUnmount(); // -- callback\n\n\n        map.getPanes().overlayPane.removeChild(this._canvas);\n\n        map.off(this.getEvents(),this);\n\n        this._canvas = null;\n\n    },\n\n    //------------------------------------------------------------\n    addTo: function (map) {\n        map.addLayer(this);\n        return this;\n    },\n    // --------------------------------------------------------------------------------\n    LatLonToMercator: function (latlon) {\n        return {\n            x: latlon.lng * 6378137 * Math.PI / 180,\n            y: Math.log(Math.tan((90 + latlon.lat) * Math.PI / 360)) * 6378137\n        };\n    },\n\n    //------------------------------------------------------------------------------\n    drawLayer: function () {\n        // -- todo make the viewInfo properties  flat objects.\n        if (!this._map) return;\n        var size   = this._map.getSize();\n        var bounds = this._map.getBounds();\n        var zoom   = this._map.getZoom();\n\n        var center = this.LatLonToMercator(this._map.getCenter());\n        var corner = this.LatLonToMercator(this._map.containerPointToLatLng(this._map.getSize()));\n\n        var del = this._delegate || this;\n        del.onDrawLayer && del.onDrawLayer( {\n                                                layer : this,\n                                                canvas: this._canvas,\n                                                bounds: bounds,\n                                                size: size,\n                                                zoom: zoom,\n                                                center : center,\n                                                corner : corner\n                                            });\n        this._frame = null;\n    },\n    // -- L.DomUtil.setTransform from leaflet 1.0.0 to work on 0.0.7\n    //------------------------------------------------------------------------------\n    _setTransform: function (el, offset, scale) {\n        var pos = offset || new L.Point(0, 0);\n\n        el.style[L.DomUtil.TRANSFORM] =\n\t\t\t(L.Browser.ie3d ?\n\t\t\t\t'translate(' + pos.x + 'px,' + pos.y + 'px)' :\n\t\t\t\t'translate3d(' + pos.x + 'px,' + pos.y + 'px,0)') +\n\t\t\t(scale ? ' scale(' + scale + ')' : '');\n    },\n\n    //------------------------------------------------------------------------------\n    _animateZoom: function (e) {\n        var scale = this._map.getZoomScale(e.zoom);\n        // -- different calc of animation zoom  in leaflet 1.0.3 thanks @peterkarabinovic, @jduggan1\n        var offset = L.Layer ? this._map._latLngBoundsToNewLayerBounds(this._map.getBounds(), e.zoom, e.center).min :\n                               this._map._getCenterOffset(e.center)._multiplyBy(-scale).subtract(this._map._getMapPanePos());\n\n        L.DomUtil.setTransform(this._canvas, offset, scale);\n\n\n    }\n});\n\nL.canvasLayer = function () {\n    return new L.CanvasLayer();\n};\n"],"file":"leaflet-canvas-layer.js"}