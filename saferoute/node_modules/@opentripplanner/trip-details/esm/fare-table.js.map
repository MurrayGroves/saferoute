{"version":3,"sources":["../src/fare-table.tsx"],"names":["flatten","React","styled","FormattedMessage","Transfer","boldText","renderFare","FareTableText","defaultEnglishMessages","defaultMessages","TableHeader","thead","Table","table","TransferIcon","getFormattedTextForConfigKey","textKey","cash","electronic","youth","senior","special","regular","FareTypeTable","cols","fareTotals","header","legs","colsToRender","filter","col","key","length","map","fare","currency","currencyCode","cents","leg","index","routeShortName","fares","price","isTransfer","FareLegDetails","layout","transitFareDetails","transitFares","fareKeys","Object","keys","legsWithFares","reduce","prev","fareForKey","find","detail","legIndex","transitLeg","config"],"mappings":"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","sourcesContent":["import { Leg, Money } from \"@opentripplanner/types\";\nimport flatten from \"flat\";\nimport React from \"react\";\nimport styled from \"styled-components\";\nimport { FormattedMessage } from \"react-intl\";\nimport { Transfer } from \"@styled-icons/boxicons-regular/Transfer\";\n\nimport { boldText, renderFare } from \"./utils\";\n\nimport { FareLegTableProps, FareTableLayout, FareTableText } from \"./types\";\n\n// Load the default messages.\nimport defaultEnglishMessages from \"../i18n/en-US.yml\";\n\n// HACK: We should flatten the messages loaded above because\n// the YAML loaders behave differently between webpack and our version of jest:\n// - the yaml loader for webpack returns a nested object,\n// - the yaml loader for jest returns messages with flattened ids.\nconst defaultMessages: Record<string, string> = flatten(defaultEnglishMessages);\n\ntype LegAndFare = Leg & {\n  fares: Record<string, { price: Money; isTransfer?: boolean }>;\n};\n\ninterface FareTypeTableProps extends FareTableLayout {\n  fareTotals: Record<string, Money>;\n  legs: LegAndFare[];\n}\n\nconst TableHeader = styled.thead`\n  th {\n    font-weight: normal;\n    min-width: 5ch;\n    padding: 0.75em 1.5em;\n    text-align: center;\n  }\n  th:nth-of-type(2n + 1) {\n    background: #cccccc22;\n  }\n  th.main {\n    background: #333333;\n    color: #ffffffcc;\n  }\n`;\n\nconst Table = styled.table`\n  border-collapse: collapse;\n  display: block;\n  margin-bottom: 16px;\n  padding: 0;\n\n  td {\n    text-align: right;\n  }\n  td:nth-of-type(2n + 1) {\n    background: #cccccc22;\n  }\n  td.no-zebra {\n    background: none;\n  }\n  th:first-of-type {\n    height: 40px;\n  }\n`;\n\nconst TransferIcon = styled(Transfer)`\n  padding-left: 4px;\n`;\n\nconst getFormattedTextForConfigKey = (textKey: FareTableText) => {\n  switch (textKey) {\n    case FareTableText.cash:\n      return (\n        <FormattedMessage\n          defaultMessage={\n            defaultMessages[\"otpUi.TripDetails.fareDetailsHeaders.cash\"]\n          }\n          id=\"otpUi.TripDetails.fareDetailsHeaders.cash\"\n        />\n      );\n    case FareTableText.electronic:\n      return (\n        <FormattedMessage\n          defaultMessage={\n            defaultMessages[\"otpUi.TripDetails.fareDetailsHeaders.electronic\"]\n          }\n          id=\"otpUi.TripDetails.fareDetailsHeaders.electronic\"\n        />\n      );\n    case FareTableText.youth:\n      return (\n        <FormattedMessage\n          defaultMessage={\n            defaultMessages[\"otpUi.TripDetails.fareDetailsHeaders.youth\"]\n          }\n          id=\"otpUi.TripDetails.fareDetailsHeaders.youth\"\n        />\n      );\n    case FareTableText.senior:\n      return (\n        <FormattedMessage\n          defaultMessage={\n            defaultMessages[\"otpUi.TripDetails.fareDetailsHeaders.senior\"]\n          }\n          id=\"otpUi.TripDetails.fareDetailsHeaders.senior\"\n        />\n      );\n    case FareTableText.special:\n      return (\n        <FormattedMessage\n          defaultMessage={\n            defaultMessages[\"otpUi.TripDetails.fareDetailsHeaders.special\"]\n          }\n          id=\"otpUi.TripDetails.fareDetailsHeaders.special\"\n        />\n      );\n    case FareTableText.regular:\n    default:\n      return (\n        <FormattedMessage\n          defaultMessage={\n            defaultMessages[\"otpUi.TripDetails.fareDetailsHeaders.regular\"]\n          }\n          id=\"otpUi.TripDetails.fareDetailsHeaders.regular\"\n        />\n      );\n  }\n};\n\nconst FareTypeTable = ({\n  cols,\n  fareTotals,\n  header,\n  legs\n}: FareTypeTableProps): JSX.Element => {\n  const colsToRender = cols.filter(col => fareTotals[col.key]);\n  if (colsToRender.length) {\n    return (\n      <Table>\n        <TableHeader>\n          <th className=\"main\">\n            {boldText(getFormattedTextForConfigKey(header))}\n          </th>\n          {colsToRender.map(col => {\n            const fare = fareTotals[col.key];\n            return (\n              <th key={col.key}>\n                {boldText(getFormattedTextForConfigKey(col.header))}\n                <br />\n                {renderFare(\n                  fare?.currency?.currencyCode,\n                  (fare?.cents || 0) / 100\n                )}\n              </th>\n            );\n          })}\n        </TableHeader>\n        {legs.map((leg, index) => (\n          <tr key={index}>\n            <td className=\"no-zebra\">{leg.routeShortName}</td>\n            {colsToRender.map(col => {\n              const fare = leg.fares[col.key];\n              return (\n                <td key={col.key}>\n                  {renderFare(\n                    fare?.price.currency?.currencyCode,\n                    (fare?.price.cents || 0) / 100\n                  )}\n                  {fare?.isTransfer && <TransferIcon size={16} />}\n                </td>\n              );\n            })}\n          </tr>\n        ))}\n      </Table>\n    );\n  }\n  return null;\n};\n\nconst FareLegDetails = ({\n  layout,\n  legs,\n  transitFareDetails,\n  transitFares\n}: FareLegTableProps): JSX.Element => {\n  const fareKeys = Object.keys(transitFareDetails);\n\n  const legsWithFares = legs\n    .map((leg, index) => {\n      const fares = fareKeys.reduce((prev, key) => {\n        const fareForKey = transitFareDetails[key]?.find(\n          detail => detail.legIndex === index\n        );\n        if (fareForKey) {\n          prev[key] = fareForKey;\n        }\n        return prev;\n      }, {});\n      return {\n        ...leg,\n        fares\n      };\n    })\n    .filter(leg => leg.transitLeg);\n\n  return (\n    <div>\n      {layout.map(config => (\n        <FareTypeTable\n          cols={config.cols}\n          fareTotals={transitFares}\n          header={config.header}\n          key={config.header}\n          legs={legsWithFares}\n        />\n      ))}\n    </div>\n  );\n};\n\nexport default FareLegDetails;\n"],"file":"fare-table.js"}