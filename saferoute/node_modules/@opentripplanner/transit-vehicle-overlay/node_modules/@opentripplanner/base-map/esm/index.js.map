{"version":3,"sources":["../src/index.js"],"names":["React","Component","PropTypes","LayersControl","Map","Popup","TileLayer","utils","L","Styled","callIfValid","prototype","panToOffset","latlng","offsetX","offsetY","options","x","latLngToContainerPoint","parseInt","y","point","containerPointToLatLng","setView","_zoom","pan","Evented","addInitHook","singleClickTimeout","on","scheduleSingleClick","cancelSingleClick","include","setTimeout","clearSingleClickTimeout","bind","e","fireSingleClick","originalEvent","_stopped","fire","Util","extend","type","clearTimeout","BaseMap","props","overlays","showMapboxWordmark","baseLayers","layerIndex","state","activeLayer","url","startsWith","onLeftClick","onClick","forwardOne","eventName","layer","find","child","name","forwardAll","forEach","handleBaseLayerChange","onBaseLayerChange","index","findIndex","l","setState","handleOverlayAdded","handleOverlayRemoved","handleViewportChanged","registerOverlay","overlay","push","lmap","refs","map","leafletElement","eachLayer","removeLayer","center","children","maxZoom","popup","onContextMenu","onPopupClosed","zoom","userControlledOverlays","fixedOverlays","Children","toArray","newChild","cloneElement","i","retina","attribution","detectRetina","visible","location","contents","propTypes","oneOfType","node","arrayOf","shape","string","isRequired","subdomains","number","hasRetinaSupport","bool","types","latlngType","func","onOverlayAdded","onOverlayRemoved","onViewportChanged","defaultProps"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport PropTypes from \"prop-types\";\nimport { LayersControl, Map, Popup, TileLayer } from \"react-leaflet\";\nimport utils from \"@opentripplanner/core-utils\";\nimport L from \"leaflet\";\n\nimport * as Styled from \"./styled\";\nimport callIfValid from \"./util\";\n\n/**\n * panToOffset will allow you to pan the map and adjust for something like a floating\n * left nav bar, or a page header with an offset center\n *\n * @note adapted from Peter's code: https://gist.github.com/missinglink/7620340\n *\n * @param latlng\n * @param offsetX & offsetY: defaults to [0, 0] ([X, Y] pixel offsets center) a positive x\n * offset to shift the center to the right, and a positive y offset to shift the center to the\n * bottom. Negatives will move to the center point left and top.\n * @param options: pan options https://leafletjs.com/reference.html#pan-options\n * @return return value from a call to https://leafletjs.com/reference.html#map-panto\n */\nL.Map.prototype.panToOffset = function(latlng, offsetX, offsetY, options) {\n  const x =\n    this.latLngToContainerPoint(latlng).x - (parseInt(offsetX, 10) || 0);\n  const y =\n    this.latLngToContainerPoint(latlng).y - (parseInt(offsetY, 10) || 0);\n  const point = this.containerPointToLatLng([x, y]);\n  /* eslint-disable-next-line no-underscore-dangle */\n  return this.setView(point, this._zoom, { pan: options });\n};\n\n// eslint-disable-next-line func-names\nL.Evented.addInitHook(function() {\n  if (this) this.singleClickTimeout = null;\n  this.on(\"click\", this.scheduleSingleClick, this);\n  this.on(\"dblclick dragstart zoomstart\", this.cancelSingleClick, this);\n});\n\nL.Evented.include({\n  cancelSingleClick() {\n    // This timeout is key to workaround an issue where double-click events\n    // are fired in this order on some touch browsers: ['click', 'dblclick', 'click']\n    // instead of ['click', 'click', 'dblclick']\n    // eslint-disable-next-line @typescript-eslint/no-implied-eval\n    setTimeout(this.clearSingleClickTimeout.bind(this), 0);\n  },\n\n  scheduleSingleClick(e) {\n    this.clearSingleClickTimeout();\n\n    this.singleClickTimeout = setTimeout(\n      // eslint-disable-next-line @typescript-eslint/no-implied-eval\n      this.fireSingleClick.bind(this, e),\n      this.options.singleClickTimeout || 500\n    );\n  },\n\n  fireSingleClick(e) {\n    // eslint-disable-next-line no-underscore-dangle\n    if (!e.originalEvent._stopped) {\n      this.fire(\"singleclick\", L.Util.extend(e, { type: \"singleclick\" }));\n    }\n  },\n\n  clearSingleClickTimeout() {\n    if (this.singleClickTimeout !== null) {\n      clearTimeout(this.singleClickTimeout);\n      this.singleClickTimeout = null;\n    }\n  }\n});\n\n/**\n * The BaseMap component renders a Leaflet map with overlays and other ad-hoc\n * markers that are declared as child elements of the BaseMap element.\n *\n * Overlays are groups of similar React-Leaflet markers, e.g. vehicle location\n * markers, bus stop markers, etc.\n * Overlays are automatically added to the overlay control displayed by the\n * BaseMap. The user uses that control to turn overlays on or off.\n * See the\n * [Two Overlays From TriMet Transit Components](./?path=/story/basemap--with-two-overlays-from-trimet-transit-components)\n * example for more information on overlays.\n */\nclass BaseMap extends Component {\n  overlays = [];\n\n  constructor(props) {\n    super(props);\n    // Default active base layer index to zero (first layer).\n    // TODO: derive layerIndex from props?\n    this.state = {\n      layerIndex: 0\n    };\n  }\n\n  componentDidMount() {\n    // register single click event\n    const lmap = this.refs.map.leafletElement;\n    lmap.options.singleClickTimeout = 250;\n    lmap.on(\"singleclick\", this.onLeftClick);\n  }\n\n  componentDidUpdate() {}\n\n  // remove custom overlays on unmount\n  // TODO: Is this needed? It may have something to do with mobile vs desktop views\n  componentWillUnmount() {\n    const lmap = this.refs.map.leafletElement;\n    lmap.eachLayer(layer => {\n      // Do not inline, there is a 'this' implied.\n      lmap.removeLayer(layer);\n    });\n  }\n\n  /**\n   * Returns whether to show the Mapbox wordmark (if the current layer's URL is\n   * a Mapbox url).\n   */\n  showMapboxWordmark = () => {\n    const { baseLayers } = this.props;\n    const { layerIndex } = this.state;\n    // Get current layer and check its URL.\n    const activeLayer = baseLayers[layerIndex];\n    return activeLayer && activeLayer.url.startsWith(\"//api.mapbox.com\");\n  };\n\n  onLeftClick = e => {\n    const { onClick } = this.props;\n    callIfValid(onClick)(e);\n  };\n\n  forwardOne = (eventName, e) => {\n    // Call the event handler, if implemented, on the layer for which this event applies.\n    const layer = this.overlays.find(child => child.props.name === e.name);\n    if (layer) callIfValid(layer[eventName])(e);\n\n    // Call the event handler on this control's parent element.\n    // eslint-disable-next-line react/destructuring-assignment\n    callIfValid(this.props[eventName])(e);\n  };\n\n  forwardAll = (eventName, e) => {\n    // Call the event handler, if implemented, on each registered overlay.\n    this.overlays.forEach(layer => {\n      callIfValid(layer[eventName])(e);\n    });\n\n    // Call the event handler on this control's parent element.\n    // eslint-disable-next-line react/destructuring-assignment\n    callIfValid(this.props[eventName])(e);\n  };\n\n  handleBaseLayerChange = e => {\n    const { baseLayers, onBaseLayerChange } = this.props;\n    // Find layer index\n    const index = baseLayers.findIndex(l => l.name === e.name);\n    const layer = baseLayers[index];\n    // Call prop if exists.\n    if (typeof onBaseLayerChange === \"function\") {\n      onBaseLayerChange({ index, layer });\n    }\n    // Update active index in state.\n    this.setState({ layerIndex: index });\n  };\n\n  handleOverlayAdded = e => {\n    this.forwardOne(\"onOverlayAdded\", e);\n  };\n\n  handleOverlayRemoved = e => {\n    this.forwardOne(\"onOverlayRemoved\", e);\n  };\n\n  handleViewportChanged = e => {\n    this.forwardAll(\"onViewportChanged\", e);\n  };\n\n  registerOverlay = overlay => {\n    this.overlays.push(overlay);\n  };\n\n  render() {\n    const {\n      baseLayers,\n      center,\n      children,\n      maxZoom,\n      popup,\n      onContextMenu,\n      onPopupClosed,\n      zoom\n    } = this.props;\n    const { layerIndex } = this.state;\n\n    // Separate overlay layers into user-controlled (those with a checkbox in\n    // the layer control) and those that are needed by the app (e.g., stop viewer\n    // and itinerary overlay).\n    const userControlledOverlays = [];\n    const fixedOverlays = [];\n    React.Children.toArray(children).forEach(child => {\n      if (child.props.name) {\n        const newChild = React.cloneElement(child, {\n          // Inject registerOverlay prop to each custom overlay.\n          registerOverlay: this.registerOverlay\n        });\n        userControlledOverlays.push(newChild);\n      } else fixedOverlays.push(child);\n    });\n\n    return (\n      <Map\n        ref=\"map\"\n        className=\"map\"\n        center={center}\n        zoom={zoom}\n        maxZoom={maxZoom}\n        // onClick={this.onLeftClick}\n        // Note: Map-click is handled via single-click plugin, set up in componentDidMount()\n        onContextMenu={onContextMenu}\n        onOverlayAdd={this.handleOverlayAdded}\n        onBaseLayerChange={this.handleBaseLayerChange}\n        onOverlayRemove={this.handleOverlayRemoved}\n        onViewportChanged={this.handleViewportChanged}\n      >\n        {/* Add the mapbox wordmark if the current base layer's URL appears to\n          be a Mapbox URL. The implementing application must include CSS that\n          properly displays the wordmark. See Mapbox website for example CSS:\n          https://docs.mapbox.com/help/how-mapbox-works/attribution/#other-mapping-frameworks */}\n        {this.showMapboxWordmark() && (\n          <a\n            href=\"http://mapbox.com/about/maps\"\n            className=\"mapbox-wordmark\"\n            target=\"_blank noopener noreferrer\"\n          >\n            Mapbox\n          </a>\n        )}\n\n        {/* Create the layers control, including base map layers and any\n         * user-controlled overlays. */}\n        <LayersControl position=\"topright\">\n          {/* base layers */}\n          {baseLayers &&\n            baseLayers.map((layer, i) => {\n              return (\n                <LayersControl.BaseLayer\n                  name={layer.name}\n                  checked={i === layerIndex}\n                  key={i}\n                >\n                  {\n                    // Fix tile size/zoom offset: https://stackoverflow.com/a/37043490/915811\n                    // Also, split the declaration between the two\n                    // outcomes to avoid error 'attempted to load an infinite number of tiles'\n                    // if the tiles cannot be loaded for any reason.\n                  }\n                  {layer.retina ? (\n                    <TileLayer\n                      url={layer.url}\n                      attribution={layer.attribution}\n                      retina={layer.retina}\n                      maxZoom={layer.maxZoom}\n                      tileSize={512}\n                      zoomOffset={-1}\n                      detectRetina={layer.detectRetina}\n                    />\n                  ) : (\n                    <TileLayer\n                      url={layer.url}\n                      attribution={layer.attribution}\n                      maxZoom={layer.maxZoom}\n                      detectRetina={layer.detectRetina}\n                    />\n                  )}\n                </LayersControl.BaseLayer>\n              );\n            })}\n\n          {/* user-controlled overlay layers (e.g., vehicle locations, stops) */}\n          {userControlledOverlays.map((child, i) => (\n            <LayersControl.Overlay\n              key={i}\n              name={child.props.name}\n              checked={child.props.visible}\n            >\n              {child}\n            </LayersControl.Overlay>\n          ))}\n        </LayersControl>\n\n        {/* Add the fixed, i.e. non-user-controllable, overlays (e.g., itinerary overlay) */}\n        {fixedOverlays}\n\n        {/* Add the location selection popup and content, if both are set. */}\n        {popup && popup.location && popup.contents && (\n          <Popup position={popup.location} onClose={onPopupClosed}>\n            {popup.contents}\n          </Popup>\n        )}\n      </Map>\n    );\n  }\n}\n\nBaseMap.propTypes = {\n  /**\n   * Zero, one, or multiple components that extend { MapLayer } from 'react-leaflet'.\n   * Children can be overlays or loose markers.\n   */\n  children: PropTypes.oneOfType([\n    // Ideally, the types below should be MapLayer,\n    // however, during type validation in the browser,\n    // MapLayer components all seem to resolve to Object.\n    PropTypes.node,\n    PropTypes.arrayOf(PropTypes.node)\n  ]),\n  /**\n   * The base (background) layers for the map.\n   */\n  baseLayers: PropTypes.arrayOf(\n    PropTypes.shape({\n      name: PropTypes.string.isRequired,\n      url: PropTypes.string.isRequired,\n      subdomains: PropTypes.string,\n      attribution: PropTypes.string,\n      maxZoom: PropTypes.number,\n      hasRetinaSupport: PropTypes.bool\n    })\n  ),\n  /**\n   * The center of the map, as a [lat, lng] array.\n   */\n  center: utils.types.latlngType.isRequired,\n  /**\n   * The maximum zoom level allowed on the map.\n   */\n  maxZoom: PropTypes.number,\n  /**\n   * Triggered when the user changes the active base layer.\n   * See https://leafletjs.com/reference-1.7.1.html#map-baselayerchange\n   */\n  onBaseLayerChange: PropTypes.func,\n  /**\n   * Triggered when the user clicks on the map.\n   * See https://leafletjs.com/reference-1.6.0.html#map-click for details.\n   */\n  onClick: PropTypes.func,\n  /**\n   * Triggered when the user right-clicks on the map or, on a mobile device, presses the map for a second (\"long-press\").\n   * See https://leafletjs.com/reference-1.6.0.html#map-contextmenu for details.\n   */\n  onContextMenu: PropTypes.func,\n  /**\n   * Triggered when the user makes an overlay visible using the map's layers control.\n   * See https://leafletjs.com/reference-1.6.0.html#map-overlayadd for details.\n   */\n  // eslint-disable-next-line react/no-unused-prop-types\n  onOverlayAdded: PropTypes.func,\n  /**\n   * Triggered when the user hides an overlay using the map's layers control.\n   * See https://leafletjs.com/reference-1.6.0.html#map-overlayremove for details.\n   */\n  // eslint-disable-next-line react/no-unused-prop-types\n  onOverlayRemoved: PropTypes.func,\n  /**\n   * Triggered when the user closes the popup (if `popupLocation` and `popupContent` have been set).\n   */\n  onPopupClosed: PropTypes.func,\n  /**\n   * Triggered when the user pans the map or changes zoom level.\n   * See https://github.com/PaulLeCam/react-leaflet/blob/master/example/components/viewport.js for more details.\n   */\n  // eslint-disable-next-line react/no-unused-prop-types\n  onViewportChanged: PropTypes.func,\n  /**\n   * The contents and location (in [lat, lng] format) of the popup to display, or null if no popup is displayed.\n   */\n  popup: PropTypes.shape({\n    contents: PropTypes.node.isRequired,\n    location: utils.types.latlngType.isRequired\n  }),\n  /**\n   * The zoom level of the map.\n   */\n  zoom: PropTypes.number\n};\n\nBaseMap.defaultProps = {\n  children: null,\n  baseLayers: [\n    {\n      name: \"Streets\",\n      url:\n        \"//cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}@2x.png\",\n      attribution:\n        'Map tiles: &copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a>, &copy; <a href=\"https://carto.com/attributions\">CARTO</a>',\n      maxZoom: 20\n\n      // FIXME?? CartoDB displays characters proportionally too large\n      // on regular monitors (1080p or lower) when using the \"retina\" parameters below.\n      // (That does not happen on \"retina\" displays such as Macbook or mobile phones.)\n      // url:\n      //  \"//cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}{retina}.png\",\n      // retina: \"@2x\",\n      // detectRetina: true\n    }\n  ],\n  maxZoom: 20,\n  onBaseLayerChange: null,\n  onClick: null,\n  onContextMenu: null,\n  onOverlayAdded: null,\n  onOverlayRemoved: null,\n  onPopupClosed: null,\n  onViewportChanged: null,\n  popup: null,\n  zoom: 13\n};\n\nexport default BaseMap;\n\nexport { Styled };\n"],"file":"index.js"}