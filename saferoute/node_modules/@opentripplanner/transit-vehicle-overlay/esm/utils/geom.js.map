{"version":3,"sources":["../../src/utils/geom.js"],"names":["React","Polyline","turf","nearestPointOnLine","makeSplitLine","splitGeom","highlight","lowlight","segments","length","push","key","geometry","findPointOnLine","splitPoint","geom","retVal","pt","point","line","lineString","snapped","units","properties","index","splitLineGeometry","splitPt","geomPast","geomFuture","i","reverseGeojsonPoints","revPoints","coordinates","c","makePattern","geojson","id","data","pattern"],"mappings":"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","sourcesContent":["/**\n * utilities to manipulate (line) geometries, ala splitting the pattern geometry into 2\n * sections, of has already travelled, and to be travelled, etc...\n */\nimport React from \"react\";\nimport { Polyline } from \"react-leaflet\";\nimport * as turf from \"@turf/helpers\";\nimport nearestPointOnLine from \"@turf/nearest-point-on-line\";\n\n/**\n * creates the line segments array for the overlay\n *\n * @param splitGeom\n * @param highlight\n * @param lowlight\n * @returns {Array}\n */\nexport function makeSplitLine(splitGeom, highlight, lowlight) {\n  const segments = [];\n  if (splitGeom && splitGeom.length === 2) {\n    segments.push(\n      <Polyline\n        key={splitGeom[0].key}\n        positions={splitGeom[0].geometry}\n        {...lowlight} // eslint-disable-line react/jsx-props-no-spreading\n      />\n    );\n    segments.push(\n      <Polyline\n        key={splitGeom[1].key}\n        positions={splitGeom[1].geometry}\n        {...highlight} // eslint-disable-line react/jsx-props-no-spreading\n      />\n    );\n  }\n  return segments;\n}\n\n/**\n * returns the point (geom array index) on the line that is closest to the vehicle\n *\n * @param vehicle\n * @param geom\n * @returns {number}\n */\nexport function findPointOnLine(splitPoint, geom) {\n  let retVal = 0;\n  if (splitPoint && geom && geom.length > 1) {\n    const pt = turf.point(splitPoint);\n    const line = turf.lineString(geom);\n    const snapped = nearestPointOnLine(line, pt, { units: \"miles\" });\n    if (\n      snapped &&\n      snapped.properties.index &&\n      snapped.properties.index < geom.length\n    ) {\n      retVal = snapped.properties.index;\n    }\n  }\n  return retVal;\n}\n\n/**\n * break a line geometry in 2 at the vehicle location\n * @param geom\n * @param splitPt\n * @param key\n * @returns {*}\n */\nexport function splitLineGeometry(geom, splitPt, key) {\n  let retVal = null;\n  if (geom) {\n    const geomPast = [];\n    const geomFuture = [];\n\n    for (let i = 0; i < geom.length; i++) {\n      if (i <= splitPt) geomPast.push(geom[i]);\n      if (i >= splitPt) geomFuture.push(geom[i]);\n    }\n    retVal = [\n      { key: `${key}-PAST`, geometry: geomPast },\n      { key: `${key}-FUTURE`, geometry: geomFuture }\n    ];\n  }\n  return retVal;\n}\n\n/**\n * geojson uses [lon,lat] (e.g., [X, Y]) in representing coordinates\n * this utility function reverses the point order to be [lat, lon] (or [Y, X])\n *\n * @return array of reversed points in the line geom\n */\nexport function reverseGeojsonPoints(geom) {\n  const revPoints = [];\n  for (let i = 0; i < geom.coordinates.length; i++) {\n    if (geom.coordinates[i] && geom.coordinates[i].length === 2) {\n      const c = [geom.coordinates[i][1], geom.coordinates[i][0]];\n      revPoints.push(c);\n    }\n  }\n  return revPoints;\n}\n\n/** turns geojson line into a pattern (line + id object) for route renderer */\nexport function makePattern(geojson, id) {\n  const data = reverseGeojsonPoints(geojson);\n  const pattern = { id, data };\n  return pattern;\n}\n"],"file":"geom.js"}