{"version":3,"sources":["../src/itinerary.ts"],"names":["polyline","turfAlong","transitModes","getTransitModes","config","modes","map","tm","mode","isTransit","includes","isReservationRequired","leg","boardRule","alightRule","isCoordinationRequired","isFlex","isAdvanceBookingRequired","info","latestBookingTime","daysPrior","legDropoffRequiresAdvanceBooking","dropOffBookingInfo","isRideshareLeg","rideHailingEstimate","provider","id","isWalk","isBicycle","isBicycleRent","isCar","startsWith","isMicromobility","isAccessMode","hasTransit","modesStr","split","some","hasCar","hasBike","hasMicromobility","hasHail","indexOf","hasRental","getMapColor","get","toSentenceCase","str","String","charAt","toUpperCase","substr","toLowerCase","getCompanyFromLeg","from","rentedBike","rentedCar","rentedVehicle","networks","rentalVehicle","network","getItineraryBounds","itinerary","coords","legs","forEach","legCoords","toGeoJSON","legGeometry","points","coordinates","c","getLegBounds","length","push","lat","lon","to","legLocationAtDistance","distance","line","pt","units","geometry","e","legElevationAtDistance","traversed","unshift","i","start","elevDistanceSpan","console","warn","pct","elevSpan","getElevationProfile","steps","unitConversion","minElev","maxElev","gain","loss","previous","step","elevation","elev","diff","second","first","convertedElevation","getTextWidth","text","font","canvas","document","createElement","context","getContext","metrics","measureText","width","getCompanyForNetwork","networkString","companies","company","find","co","getCompaniesLabelFromNetworks","filter","label","join","getTNCLocation","type","location","toFixed","calculatePhysicalActivity","walkDuration","bikeDuration","duration","caloriesBurned","calculateTncFares","reduce","maxTNCFare","minTNCFare","minPrice","maxPrice","currencyCode","currency","code","amount","getTransitFare","fareComponent","transitFare","cents","CARBON_INTENSITY_DEFAULTS","walk","bicycle","car","tram","subway","rail","bus","ferry","cable_car","gondola","funicular","transit","leg_switch","airplane","micromobility","calculateEmissions","carbonIntensity","carbonIntensityWithDefaults","totalCarbon","total","getDisplayedStopId","placeOrStop","stopId","stopCode","getLegsWithFares","fareProducts","fare","legProducts","lp","legIndices","flatMap","products","getLegCost","category","container","price","undefined","relevantFareProducts","fp","name","totalCost","transferFareProduct","transferAmount","getItineraryCost","prev","cur"],"mappings":"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","sourcesContent":["import polyline from \"@mapbox/polyline\";\nimport {\n  Company,\n  Config,\n  ElevationProfile,\n  FlexBookingInfo,\n  Itinerary,\n  ItineraryOnlyLegsRequired,\n  LatLngArray,\n  Leg,\n  MassUnitOption,\n  Money,\n  Place,\n  Step,\n  Stop,\n  TncFare\n} from \"@opentripplanner/types\";\nimport turfAlong from \"@turf/along\";\n\n// All OTP transit modes\nexport const transitModes = [\n  \"TRAM\",\n  \"BUS\",\n  \"SUBWAY\",\n  \"FERRY\",\n  \"RAIL\",\n  \"GONDOLA\"\n];\n\n/**\n * @param  {config} config OTP-RR configuration object\n * @return {Array}  List of all transit modes defined in config; otherwise default mode list\n */\n\nexport function getTransitModes(config: Config): string[] {\n  if (!config || !config.modes || !config.modes.transitModes)\n    return transitModes;\n\n  return config.modes.transitModes.map(tm =>\n    typeof tm !== \"string\" ? tm.mode : tm\n  );\n}\n\nexport function isTransit(mode: string): boolean {\n  return transitModes.includes(mode) || mode === \"TRANSIT\";\n}\n\n/**\n * Returns true if the leg pickup rules enabled which require\n * calling ahead for the service to run. \"mustPhone\" is the only\n * property which encodes this info.\n */\nexport function isReservationRequired(leg: Leg): boolean {\n  return leg.boardRule === \"mustPhone\" || leg.alightRule === \"mustPhone\";\n}\n/**\n * Returns true if a user must ask the driver to let the user off\n * or if the user must flag the driver down for pickup.\n * \"coordinateWithDriver\" in board/alight rule encodes this info.\n */\nexport function isCoordinationRequired(leg: Leg): boolean {\n  return (\n    leg.boardRule === \"coordinateWithDriver\" ||\n    leg.alightRule === \"coordinateWithDriver\"\n  );\n}\n/**\n * The two rules checked by the above two functions are the only values\n * returned by OTP when a leg is a flex leg.\n */\nexport function isFlex(leg: Leg): boolean {\n  return isReservationRequired(leg) || isCoordinationRequired(leg);\n}\n\nexport function isAdvanceBookingRequired(info: FlexBookingInfo): boolean {\n  return info?.latestBookingTime?.daysPrior > 0;\n}\nexport function legDropoffRequiresAdvanceBooking(leg: Leg): boolean {\n  return isAdvanceBookingRequired(leg.dropOffBookingInfo);\n}\n\nexport function isRideshareLeg(leg: Leg): boolean {\n  return !!leg.rideHailingEstimate?.provider?.id;\n}\n\nexport function isWalk(mode: string): boolean {\n  if (!mode) return false;\n\n  return mode === \"WALK\";\n}\n\nexport function isBicycle(mode: string): boolean {\n  if (!mode) return false;\n\n  return mode === \"BICYCLE\";\n}\n\nexport function isBicycleRent(mode: string): boolean {\n  if (!mode) return false;\n\n  return mode === \"BICYCLE_RENT\";\n}\n\nexport function isCar(mode: string): boolean {\n  if (!mode) return false;\n  return mode.startsWith(\"CAR\");\n}\n\nexport function isMicromobility(mode: string): boolean {\n  if (!mode) return false;\n  return mode.startsWith(\"MICROMOBILITY\") || mode.startsWith(\"SCOOTER\");\n}\n\nexport function isAccessMode(mode: string): boolean {\n  return (\n    isWalk(mode) ||\n    isBicycle(mode) ||\n    isBicycleRent(mode) ||\n    isCar(mode) ||\n    isMicromobility(mode)\n  );\n}\n\n/**\n * @param  {string}  modesStr a comma-separated list of OTP modes\n * @return {boolean} whether any of the modes are transit modes\n */\nexport function hasTransit(modesStr: string): boolean {\n  return modesStr.split(\",\").some(mode => isTransit(mode));\n}\n\n/**\n * @param  {string}  modesStr a comma-separated list of OTP modes\n * @return {boolean} whether any of the modes are car-based modes\n */\nexport function hasCar(modesStr: string): boolean {\n  return modesStr.split(\",\").some(mode => isCar(mode));\n}\n\n/**\n * @param  {string}  modesStr a comma-separated list of OTP modes\n * @return {boolean} whether any of the modes are bicycle-based modes\n */\nexport function hasBike(modesStr: string): boolean {\n  return modesStr\n    .split(\",\")\n    .some(mode => isBicycle(mode) || isBicycleRent(mode));\n}\n\n/**\n * @param  {string}  modesStr a comma-separated list of OTP modes\n * @return {boolean} whether any of the modes are micromobility-based modes\n */\nexport function hasMicromobility(modesStr: string): boolean {\n  return modesStr.split(\",\").some(mode => isMicromobility(mode));\n}\n\n/**\n * @param  {string}  modesStr a comma-separated list of OTP modes\n * @return {boolean} whether any of the modes is a hailing mode\n */\nexport function hasHail(modesStr: string): boolean {\n  return modesStr.split(\",\").some(mode => mode.indexOf(\"_HAIL\") > -1);\n}\n\n/**\n * @param  {string}  modesStr a comma-separated list of OTP modes\n * @return {boolean} whether any of the modes is a rental mode\n */\nexport function hasRental(modesStr: string): boolean {\n  return modesStr.split(\",\").some(mode => mode.indexOf(\"_RENT\") > -1);\n}\n\nexport function getMapColor(mode: string): string {\n  mode = mode || this.get(\"mode\");\n  if (mode === \"WALK\") return \"#444\";\n  if (mode === \"BICYCLE\") return \"#0073e5\";\n  if (mode === \"SUBWAY\") return \"#e60000\";\n  if (mode === \"RAIL\") return \"#b00\";\n  if (mode === \"BUS\") return \"#080\";\n  if (mode === \"TRAM\") return \"#800\";\n  if (mode === \"FERRY\") return \"#008\";\n  if (mode === \"CAR\") return \"#444\";\n  if (mode === \"MICROMOBILITY\" || mode === \"SCOOTER\") return \"#f5a729\";\n  return \"#aaa\";\n}\n\nexport function toSentenceCase(str: string): string {\n  if (str == null) {\n    return \"\";\n  }\n  str = String(str);\n  return str.charAt(0).toUpperCase() + str.substr(1).toLowerCase();\n}\n\n/**\n * Derive the company string based on mode and network associated with leg.\n */\nexport function getCompanyFromLeg(leg: Leg): string {\n  if (!leg) return null;\n  const {\n    from,\n    mode,\n    rentedBike,\n    rentedCar,\n    rentedVehicle,\n    rideHailingEstimate\n  } = leg;\n  if (mode === \"CAR\" && rentedCar) {\n    return from.networks[0];\n  }\n  if (mode === \"CAR\" && rideHailingEstimate) {\n    return rideHailingEstimate.provider.id;\n  }\n  if (mode === \"BICYCLE\" && rentedBike && from.networks) {\n    return from.networks[0];\n  }\n  if (from.rentalVehicle) {\n    return from.rentalVehicle.network;\n  }\n  if (\n    (mode === \"MICROMOBILITY\" || mode === \"SCOOTER\") &&\n    rentedVehicle &&\n    from.networks\n  ) {\n    return from.networks[0];\n  }\n  return null;\n}\n\nexport function getItineraryBounds(\n  itinerary: ItineraryOnlyLegsRequired\n): LatLngArray[] {\n  let coords = [];\n  itinerary.legs.forEach(leg => {\n    const legCoords = polyline\n      .toGeoJSON(leg.legGeometry.points)\n      .coordinates.map((c: number[]) => [c[1], c[0]]);\n    coords = [...coords, ...legCoords];\n  });\n  return coords;\n}\n\n/**\n * Return a coords object that encloses the given leg's geometry.\n */\nexport function getLegBounds(leg: Leg): number[][] {\n  const coords = polyline\n    .toGeoJSON(leg.legGeometry.points)\n    .coordinates.map(c => [c[1], c[0]]);\n\n  // in certain cases, there might be zero-length coordinates in the leg\n  // geometry. In these cases, build us an array of coordinates using the from\n  // and to data of the leg.\n  if (coords.length === 0) {\n    coords.push([leg.from.lat, leg.from.lon], [leg.to.lat, leg.to.lon]);\n  }\n  return coords;\n}\n\n/* Returns an interpolated lat-lon at a specified distance along a leg */\n\nexport function legLocationAtDistance(leg: Leg, distance: number): number[] {\n  if (!leg.legGeometry) return null;\n\n  try {\n    const line = polyline.toGeoJSON(leg.legGeometry.points);\n    const pt = turfAlong(line, distance, { units: \"meters\" });\n    if (pt && pt.geometry && pt.geometry.coordinates) {\n      return [pt.geometry.coordinates[1], pt.geometry.coordinates[0]];\n    }\n  } catch (e) {\n    // FIXME handle error!\n  }\n\n  return null;\n}\n\n/* Returns an interpolated elevation at a specified distance along a leg */\n\nexport function legElevationAtDistance(\n  points: number[][],\n  distance: number\n): number {\n  // Iterate through the combined elevation profile\n  let traversed = 0;\n  // If first point distance is not zero, insert starting point at zero with\n  // null elevation. Encountering this value should trigger the warning below.\n  if (points[0][0] > 0) {\n    points.unshift([0, null]);\n  }\n  for (let i = 1; i < points.length; i++) {\n    const start = points[i - 1];\n    const elevDistanceSpan = points[i][0] - start[0];\n    if (distance >= traversed && distance <= traversed + elevDistanceSpan) {\n      // Distance falls within this point and the previous one;\n      // compute & return iterpolated elevation value\n      if (start[1] === null) {\n        console.warn(\n          \"Elevation value does not exist for distance.\",\n          distance,\n          traversed\n        );\n        return null;\n      }\n      const pct = (distance - traversed) / elevDistanceSpan;\n      const elevSpan = points[i][1] - start[1];\n      return start[1] + elevSpan * pct;\n    }\n    traversed += elevDistanceSpan;\n  }\n  console.warn(\n    \"Elevation value does not exist for distance.\",\n    distance,\n    traversed\n  );\n  return null;\n}\n\n// Iterate through the steps, building the array of elevation points and\n// keeping track of the minimum and maximum elevations reached\nexport function getElevationProfile(\n  steps: Step[],\n  unitConversion = 1\n): ElevationProfile {\n  let minElev = 100000;\n  let maxElev = -100000;\n  let traversed = 0;\n  let gain = 0;\n  let loss = 0;\n  let previous = null;\n  const points = [];\n  steps.forEach(step => {\n    if (!step.elevation || step.elevation.length === 0) {\n      traversed += step.distance;\n      return;\n    }\n    for (let i = 0; i < step.elevation.length; i++) {\n      const elev = step.elevation[i];\n      if (previous) {\n        const diff = (elev.second - previous.second) * unitConversion;\n        if (diff > 0) gain += diff;\n        else loss += diff;\n      }\n      if (i === 0 && elev.first !== 0) {\n        // console.warn(`No elevation data available for step ${stepIndex}-${i} at beginning of segment`, elev)\n      }\n      const convertedElevation = elev.second * unitConversion;\n      if (convertedElevation < minElev) minElev = convertedElevation;\n      if (convertedElevation > maxElev) maxElev = convertedElevation;\n      points.push([traversed + elev.first, elev.second]);\n      // Insert \"filler\" point if the last point in elevation profile does not\n      // reach the full distance of the step.\n      if (i === step.elevation.length - 1 && elev.first !== step.distance) {\n        // points.push([traversed + step.distance, elev.second])\n      }\n      previous = elev;\n    }\n    traversed += step.distance;\n  });\n  return { maxElev, minElev, points, traversed, gain, loss };\n}\n\n/**\n * Uses canvas.measureText to compute and return the width of the given text of given font in pixels.\n *\n * @param {string} text The text to be rendered.\n * @param {string} font The css font descriptor that text is to be rendered with (e.g. \"bold 14px verdana\").\n *\n * @see https://stackoverflow.com/questions/118241/calculate-text-width-with-javascript/21015393#21015393\n */\nexport function getTextWidth(text: string, font = \"22px Arial\"): number {\n  // Create custom type for function including re-used canvas object\n  type GetTextWidth = typeof getTextWidth & { canvas: HTMLCanvasElement };\n\n  // re-use canvas object for better performance\n  const canvas =\n    (getTextWidth as GetTextWidth).canvas ||\n    ((getTextWidth as GetTextWidth).canvas = document.createElement(\"canvas\"));\n  const context = canvas.getContext(\"2d\");\n  context.font = font;\n  const metrics = context.measureText(text);\n  return metrics.width;\n}\n\n/**\n * Get the configured company object for the given network string if the company\n * has been defined in the provided companies array config.\n */\nexport function getCompanyForNetwork(\n  networkString: string,\n  companies: Company[] = []\n): Company {\n  const company = companies.find(co => co.id === networkString);\n  if (!company) {\n    console.warn(\n      `No company found in config.yml that matches rented vehicle network: ${networkString}`,\n      companies\n    );\n  }\n  return company;\n}\n\n/**\n * Get a string label to display from a list of vehicle rental networks.\n *\n * @param  {Array<string>} networks  A list of network ids.\n * @param  {Array<object>}  [companies=[]] An optional list of the companies config.\n * @return {string}  A label for use in presentation on a website.\n */\nexport function getCompaniesLabelFromNetworks(\n  networks: string[],\n  companies: Company[] = []\n): string {\n  return networks\n    .map(network => getCompanyForNetwork(network, companies))\n    .filter(co => !!co)\n    .map(co => co.label)\n    .join(\"/\");\n}\n\nexport function getTNCLocation(leg: Leg, type: string): string {\n  const location = leg[type];\n  return `${location.lat.toFixed(5)},${location.lon.toFixed(5)}`;\n}\n\nexport function calculatePhysicalActivity(\n  itinerary: ItineraryOnlyLegsRequired\n): {\n  bikeDuration: number;\n  caloriesBurned: number;\n  walkDuration: number;\n} {\n  let walkDuration = 0;\n  let bikeDuration = 0;\n  itinerary.legs.forEach(leg => {\n    if (leg.mode.startsWith(\"WALK\")) walkDuration += leg.duration;\n    if (leg.mode.startsWith(\"BICYCLE\")) bikeDuration += leg.duration;\n  });\n  const caloriesBurned =\n    (walkDuration / 3600) * 280 + (bikeDuration / 3600) * 290;\n  return {\n    bikeDuration,\n    caloriesBurned,\n    walkDuration\n  };\n}\n\n/**\n * For an itinerary, calculates the TNC fares and returns an object with\n * these values and currency info.\n * It is assumed that the same currency is used for all TNC legs.\n */\nexport function calculateTncFares(\n  itinerary: ItineraryOnlyLegsRequired\n): TncFare {\n  return itinerary.legs\n    .filter(leg => leg.mode === \"CAR\" && leg.rideHailingEstimate)\n    .reduce(\n      ({ maxTNCFare, minTNCFare }, { rideHailingEstimate }) => {\n        const { minPrice, maxPrice } = rideHailingEstimate;\n        return {\n          // Assumes a single currency for entire itinerary.\n          currencyCode: minPrice.currency.code,\n          maxTNCFare: maxTNCFare + maxPrice.amount,\n          minTNCFare: minTNCFare + minPrice.amount\n        };\n      },\n      {\n        currencyCode: null,\n        maxTNCFare: 0,\n        minTNCFare: 0\n      }\n    );\n}\n\n/**\n * For a given fare component (either total fare or component parts), returns\n * an object with the fare value (in cents).\n */\nexport function getTransitFare(\n  fareComponent: Money\n): {\n  currencyCode: string;\n  transitFare: number;\n} {\n  return fareComponent\n    ? {\n        currencyCode: fareComponent.currency.currencyCode,\n        transitFare: fareComponent.cents\n      }\n    : {\n        currencyCode: \"USD\",\n        transitFare: 0\n      };\n}\n\n/**\n * Sources:\n * - https://www.itf-oecd.org/sites/default/files/docs/environmental-performance-new-mobility.pdf\n * - https://www.thrustcarbon.com/insights/how-to-calculate-emissions-from-a-ferry-journey\n * - https://www.itf-oecd.org/sites/default/files/life-cycle-assessment-calculations-2020.xlsx\n * Other values extrapolated.\n */\nconst CARBON_INTENSITY_DEFAULTS = {\n  walk: 0.026,\n  bicycle: 0.017,\n  car: 0.162,\n  tram: 0.066,\n  subway: 0.066,\n  rail: 0.066,\n  bus: 0.09,\n  ferry: 0.082,\n  cable_car: 0.021,\n  gondola: 0.021,\n  funicular: 0.066,\n  transit: 0.066,\n  leg_switch: 0,\n  airplane: 0.382,\n  micromobility: 0.095\n};\n\n/**\n * @param {itinerary} itinerary OTP trip itinierary, only legs is required.\n * @param {carbonIntensity} carbonIntensity carbon intensity by mode in grams/meter\n * @param {units} units units to be used in return value\n * @return Amount of carbon in chosen unit\n */\nexport function calculateEmissions(\n  // This type makes all the properties from Itinerary optional except legs.\n  itinerary: ItineraryOnlyLegsRequired,\n  carbonIntensity: Record<string, number> = {},\n  units?: MassUnitOption\n): number {\n  // Apply defaults for any values that we don't have.\n  const carbonIntensityWithDefaults = {\n    ...CARBON_INTENSITY_DEFAULTS,\n    ...carbonIntensity\n  };\n\n  // Distance is in meters, totalCarbon is in grams\n  const totalCarbon =\n    itinerary?.legs?.reduce((total, leg) => {\n      return (\n        (leg.distance * carbonIntensityWithDefaults[leg.mode.toLowerCase()] ||\n          0) + total\n      );\n    }, 0) || 0;\n\n  switch (units) {\n    case \"ounce\":\n      return totalCarbon / 28.35;\n    case \"kilogram\":\n      return totalCarbon / 1000;\n    case \"pound\":\n      return totalCarbon / 454;\n    case \"gram\":\n    default:\n      return totalCarbon;\n  }\n}\n\n/**\n * Returns the user-facing stop id to display for a stop or place, using the following priority:\n * 1. stop code,\n * 2. stop id without the agency id portion, if stop id contains an agency portion,\n * 3. stop id, whether null or not (this is the fallback case).\n */\nexport function getDisplayedStopId(placeOrStop: Place | Stop): string {\n  let stopId;\n  let stopCode;\n  if (\"stopId\" in placeOrStop) {\n    ({ stopCode, stopId } = placeOrStop);\n  } else if (\"id\" in placeOrStop) {\n    ({ code: stopCode, id: stopId } = placeOrStop);\n  }\n  return stopCode || stopId?.split(\":\")[1] || stopId;\n}\n\n/**\n * Adds the fare product info to each leg in an itinerary, from the itinerary's fare property\n * @param itinerary Itinerary with legProducts in fare object\n * @returns Itinerary with legs that have fare products attached to them\n */\nexport function getLegsWithFares(itinerary: Itinerary): Leg[] {\n  return itinerary.legs.map((leg, i) => ({\n    ...leg,\n    fareProducts: itinerary.fare?.legProducts\n      ?.filter(lp => lp?.legIndices?.includes(i))\n      .flatMap(lp => lp.products)\n  }));\n}\n\n/**\n * Extracts useful data from the fare products on a leg, such as the leg cost and transfer info.\n * @param leg Leg with fare products (must have used getLegsWithFares)\n * @param category Rider category\n * @param container Fare container (cash, electronic)\n * @returns Object containing price as well as the transfer discount amount, if a transfer was used.\n */\nexport function getLegCost(\n  leg: Leg,\n  category: string,\n  container: string\n): { price?: Money; transferAmount?: number } {\n  if (!leg.fareProducts) return { price: undefined };\n\n  const relevantFareProducts = leg.fareProducts.filter(\n    fp => fp.category.name === category && fp.container.name === container\n  );\n  const totalCost = relevantFareProducts.find(fp => fp.name === \"rideCost\")\n    ?.amount;\n  const transferFareProduct = relevantFareProducts.find(\n    fp => fp.name === \"transfer\"\n  );\n\n  return {\n    price: totalCost,\n    transferAmount: transferFareProduct?.amount?.cents\n  };\n}\n\n/**\n * Returns the total itinerary cost for a given set of legs.\n * @param legs Itinerary legs with fare products (must have used getLegsWithFares)\n * @param category Rider category (youth, regular, senior)\n * @param container Fare container (cash, electronic)\n * @returns Money object for the total itinerary cost.\n */\nexport function getItineraryCost(\n  legs: Leg[],\n  category: string,\n  container: string\n): Money {\n  return legs\n    .filter(leg => !!leg.fareProducts)\n    .map(leg => getLegCost(leg, category, container).price)\n    .reduce<Money>(\n      (prev, cur) => ({\n        cents: prev.cents + cur?.cents || 0,\n        currency: prev.currency ?? cur?.currency\n      }),\n      { cents: 0, currency: null }\n    );\n}\n"],"file":"itinerary.js"}